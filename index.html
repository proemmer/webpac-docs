<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Webpac-documents by proemmer</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/proemmer/webpac-docs">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/proemmer/webpac-docs/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/proemmer/webpac-docs/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Webpac-documents</h1>
          <p>documentation of webpac</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/proemmer">proemmer</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h1>
<a id="webpac-docs" class="anchor" href="#webpac-docs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>webpac-docs</h1>

<p>(web based plc data access)</p>

<p>By <a href="https://github.com/proemmer">Benjamin Proemmer</a></p>

<p>Webpac is a software which offers an web-interface for accessing Step7 PLC's. 
This interface enables you to read and write to/from PLC.
Furthermore it supports the functionality to subscribe for events if data changes.</p>

<p><img src="./images/System.PNG" alt="System Overview"></p>

<h2>
<a id="running-the-application" class="anchor" href="#running-the-application" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>running the application</h2>

<p>To start webpac, you have to run the following command:</p>

<p><img src="./images/start.PNG" alt="start webpac"></p>

<p>after this the application runs in the command window:</p>

<p><img src="./images/Running.PNG" alt="running webpac"></p>

<h2>
<a id="absolute-address-based-access" class="anchor" href="#absolute-address-based-access" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Absolute (address based access)</h2>

<p>The first method to read and write data is by its absolute address.
To address a value in the PLC you have to specify the area and the type.</p>

<h3>
<a id="area" class="anchor" href="#area" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Area</h3>

<table>
<thead>
<tr>
<th>Area</th>
<th>Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>DB[Number]</td>
<td>datablock</td>
</tr>
<tr>
<td>FB</td>
<td>Flags</td>
</tr>
<tr>
<td>IB</td>
<td>Input</td>
</tr>
<tr>
<td>OB</td>
<td>Output</td>
</tr>
<tr>
<td>TB</td>
<td>Timer</td>
</tr>
<tr>
<td>CB</td>
<td>Counter</td>
</tr>
</tbody>
</table>

<h3>
<a id="address" class="anchor" href="#address" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Address</h3>

<p>[Code][Offset][_Length]</p>

<table>
<thead>
<tr>
<th>Code</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>BIT</td>
<td>Boolean</td>
</tr>
<tr>
<td>B</td>
<td>Byte</td>
</tr>
<tr>
<td>BYTE</td>
<td>Byte</td>
</tr>
<tr>
<td>C</td>
<td>Char</td>
</tr>
<tr>
<td>CHAR</td>
<td>Char</td>
</tr>
<tr>
<td>DATE</td>
<td>Date</td>
</tr>
<tr>
<td>DT</td>
<td>DateTime</td>
</tr>
<tr>
<td>DATETIME</td>
<td>DateTime</td>
</tr>
<tr>
<td>DI</td>
<td>Double Integer</td>
</tr>
<tr>
<td>DINT</td>
<td>Double Integer</td>
</tr>
<tr>
<td>I</td>
<td>Integer</td>
</tr>
<tr>
<td>INT</td>
<td>Integer</td>
</tr>
<tr>
<td>R</td>
<td>Real</td>
</tr>
<tr>
<td>REAL</td>
<td>Real</td>
</tr>
<tr>
<td>TIMEBCD</td>
<td>S7 Time</td>
</tr>
<tr>
<td>S</td>
<td>String</td>
</tr>
<tr>
<td>STRING</td>
<td>String</td>
</tr>
<tr>
<td>T</td>
<td>Time</td>
</tr>
<tr>
<td>TIME</td>
<td>Time</td>
</tr>
<tr>
<td>TOD</td>
<td>TimeOf Day</td>
</tr>
<tr>
<td>W</td>
<td>Word</td>
</tr>
<tr>
<td>WORD</td>
<td>Word</td>
</tr>
<tr>
<td>CT</td>
<td>Counter</td>
</tr>
<tr>
<td>COUNT</td>
<td>Counter</td>
</tr>
</tbody>
</table>

<h2>
<a id="symbolic-symbol-based-access" class="anchor" href="#symbolic-symbol-based-access" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Symbolic (symbol based access)</h2>

<p>The second access method is by its symbolic name. For this, you have to create a 
data-mapping file. The structure of this file is an C# class with properties. 
To create such a file is very easy, you could use a tool from 
<a href="http://www.insite-gmbh.de">insite-gmbh</a> called AWLConverter. 
This tool extracts the data from the Simatic Manager and converts it 
to the representation we use. </p>

<p><img src="./images/ToolChain.PNG" alt="System Overview"></p>

<h2>
<a id="web-api" class="anchor" href="#web-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>web api</h2>

<p>To visualize and test the web api we added swagger support.</p>

<p><img src="./images/Swagger.PNG" alt="System Overview"></p>

<h2>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration</h2>

<p>The configuration file named 'appsettings.json' has the configuration settings for Logging, Plc, RuntimeCompiler and the Authentication.</p>

<h3>
<a id="logging" class="anchor" href="#logging" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Logging</h3>

<div class="highlight highlight-source-cs"><pre>  <span class="pl-s"><span class="pl-pds">"</span>Logging<span class="pl-pds">"</span></span>: {
    <span class="pl-s"><span class="pl-pds">"</span>IncludeScopes<span class="pl-pds">"</span></span>: <span class="pl-c1">false</span>,
    <span class="pl-s"><span class="pl-pds">"</span>LogLevel<span class="pl-pds">"</span></span>: {
      <span class="pl-s"><span class="pl-pds">"</span>Default<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Information<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>System<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Information<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>Microsoft<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Information<span class="pl-pds">"</span></span>
    }
  }</pre></div>

<h3>
<a id="plc" class="anchor" href="#plc" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Plc</h3>

<p>This section specifies the connection parameter to the PLC.</p>

<div class="highlight highlight-source-cs"><pre>  <span class="pl-s"><span class="pl-pds">"</span>Plc<span class="pl-pds">"</span></span>: {
    <span class="pl-s"><span class="pl-pds">"</span>ConnectionString<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Data Source=127.0.0.1:102,0,2<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>ConnectOnStartup<span class="pl-pds">"</span></span>: <span class="pl-c1">true</span>,
    <span class="pl-s"><span class="pl-pds">"</span>ReconnectOnConnectionLost<span class="pl-pds">"</span></span>: <span class="pl-c1">true</span>,
    <span class="pl-s"><span class="pl-pds">"</span>ReconnectIntervall<span class="pl-pds">"</span></span>:  <span class="pl-c1">5000</span>
  }</pre></div>

<ul>
<li>  <em>ConnectionString</em>: Defines the address to the PLC. Syntax: [IP]:[PORT],[RACK],[SLOT]</li>
<li>  <em>ConnectOnStartup</em>: If this value is <em>true</em>, webpac try connecting to PLC at the application start.</li>
<li>  <em>ReconnectOnConnectionLost</em>: If this value is <em>true</em>, webpac tries to reconnect, when PLC connection goes down.</li>
<li>  <em>ConnectReconnectIntervallOnStartup</em>: This value specifies the connection retry interval.</li>
</ul>

<h3>
<a id="runtimecompiler" class="anchor" href="#runtimecompiler" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RuntimeCompiler</h3>

<div class="highlight highlight-source-cs"><pre>  <span class="pl-s"><span class="pl-pds">"</span>RuntimeCompiler<span class="pl-pds">"</span></span>: {
    <span class="pl-s"><span class="pl-pds">"</span>Location<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>C:<span class="pl-cce">\\</span>webpac<span class="pl-cce">\\</span>data<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>Usings<span class="pl-pds">"</span></span>: [
      <span class="pl-s"><span class="pl-pds">"</span>System<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>Papper.Attributes<span class="pl-pds">"</span></span>
    ]
  }</pre></div>

<ul>
<li>  <em>Location</em>: This value specifies the Location of the symbolic file (C# class files).</li>
<li>  <em>Usings</em>: This is an array of usings depending of the class files you want compile.</li>
</ul>

<h3>
<a id="authentication" class="anchor" href="#authentication" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Authentication</h3>

<div class="highlight highlight-source-cs"><pre>  <span class="pl-s"><span class="pl-pds">"</span>Auth<span class="pl-pds">"</span></span>: {
    <span class="pl-s"><span class="pl-pds">"</span>KeyFile<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>C:<span class="pl-cce">\\</span>webpac<span class="pl-cce">\\</span>data<span class="pl-cce">\\</span>sec.key<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>TokenValidatenTimeinMinutes<span class="pl-pds">"</span></span>: <span class="pl-c1">1440</span> ,
    <span class="pl-s"><span class="pl-pds">"</span>Users<span class="pl-pds">"</span></span>: [
      {
        <span class="pl-s"><span class="pl-pds">"</span>Type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>ReadOnly<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>Username<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>ReadOnlyUsername<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>Password<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>ReadOnlyPassword<span class="pl-pds">"</span></span>
      },
      {
        <span class="pl-s"><span class="pl-pds">"</span>Type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>ReadWrite<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>Username<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>ReadWriteUsername<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>Password<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>ReadWritePassword<span class="pl-pds">"</span></span>
      }
    ]
  }</pre></div>

<ul>
<li>  <em>KeyFile</em>: This value specifies the Location of the key file for the authentication token (this file will be created on first start).</li>
<li>  <em>TokenValidatenTimeinMinutes</em>: This value specifies the validation time of the token.</li>
<li>  <em>Users.Type</em>: Select the access level for the api calls [Valid parameters are ReadOnly, ReadWrite]</li>
<li>  <em>Users.Username</em>: Name of the user for sign in.</li>
<li>  <em>Users.Password</em>: Password for the specified user.</li>
</ul>

<h2>
<a id="used-libraries" class="anchor" href="#used-libraries" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Used Libraries</h2>

<p>To get the PLC access we use two libraries as the following image describe.</p>

<p><img src="./images/webpactoplc.PNG" alt="Library communication"></p>

<h3>
<a id="papper" class="anchor" href="#papper" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Papper</h3>

<p><a href="http://proemmer.github.io/papper">Papper</a> is a data mapper which maps a C# class to a PLC data block.
This package is also available as a <a href="https://www.nuget.org/packages/Papper/">nuget</a> package.</p>

<h3>
<a id="dacs7" class="anchor" href="#dacs7" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Dacs7</h3>

<p><a href="http://proemmer.github.io/dacs7/">DacS7</a> is a low level component which handles the communication to the 
PLC and is available as a <a href="https://www.nuget.org/packages/Dacs7/">nuget</a> package.</p>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
